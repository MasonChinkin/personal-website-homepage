steps:
- id: 'npm entrypoint'
  name: node:12.10.0
  entrypoint: npm
  args: ['install']

# npm install, build, and test
- id: 'npm install'
  name: 'gcr.io/cloud-builders/npm'
  args: ['install']
- id: 'npm run build'
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'build']
- id: 'npm run test'
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'test']

# build docker container
- id: 'docker build'
  name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/personal-website/home', '.']

# push built container to container registry
- id: 'docker push'
  name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/personal-website/home']

# restart compute engine instance with latest image 
# - name: gcr.io/cloud-builders/gcloud
#   args: [ compute, instance-groups, managed, rolling-action, restart, home-1]

# tag image for search
tags: ['personal-website', 'home']